<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - The Repeaters Official</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/admin.css">
    <style>
        .admin-container {
            padding: 150px 0 50px;
            min-height: 100vh;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        }
        
        .admin-header {
            background: linear-gradient(135deg, #1e293b, #0f172a);
            color: white;
            padding: 40px;
            border-radius: var(--radius-lg);
            margin-bottom: 40px;
        }
        
        .admin-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .admin-tab {
            padding: 15px 30px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }
        
        .admin-tab.active {
            background: white;
            color: #1e293b;
        }
        
        .admin-content {
            display: none;
        }
        
        .admin-content.active {
            display: block;
        }
        
        .upload-box {
            background: white;
            border-radius: var(--radius-lg);
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-md);
        }
        
        .upload-box h3 {
            margin-bottom: 25px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .upload-box h3 i {
            color: var(--primary);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--gray-light);
            border-radius: var(--radius-md);
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
            outline: none;
        }
        
        .form-group textarea {
            min-height: 150px;
            resize: vertical;
        }
        
        .file-upload {
            border: 2px dashed var(--gray-light);
            border-radius: var(--radius-md);
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .file-upload:hover {
            border-color: var(--primary);
            background: #f8fafc;
        }
        
        .file-upload i {
            font-size: 48px;
            color: var(--gray);
            margin-bottom: 15px;
        }
        
        .file-upload input {
            display: none;
        }
        
        .question-item {
            background: white;
            border: 2px solid var(--gray-light);
            border-radius: var(--radius-md);
            padding: 25px;
            margin-bottom: 20px;
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .question-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            padding: 8px 15px;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
        }
        
        .action-btn.edit {
            background: #3b82f6;
            color: white;
        }
        
        .action-btn.delete {
            background: #ef4444;
            color: white;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .stat-box {
            background: white;
            border-radius: var(--radius-lg);
            padding: 30px;
            text-align: center;
            box-shadow: var(--shadow-md);
        }
        
        .stat-box h3 {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .stat-box p {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .recent-uploads {
            background: white;
            border-radius: var(--radius-lg);
            padding: 30px;
            box-shadow: var(--shadow-md);
        }
        
        .uploads-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .uploads-table th {
            background: var(--light);
            padding: 15px;
            text-align: left;
            color: var(--dark);
            font-weight: 600;
        }
        
        .uploads-table td {
            padding: 15px;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .status-badge {
            padding: 5px 15px;
            border-radius: var(--radius-full);
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-published {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-draft {
            background: #fef3c7;
            color: #92400e;
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .admin-header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar" id="navbar">
        <div class="container nav-container">
            <a href="index.html" class="logo">
                <div class="logo-icon">
                    <i class="fas fa-redo-alt"></i>
                </div>
                <div class="logo-text">
                    <h1>THE REPEATERS OFFICIAL</h1>
                    <p>Government Exam Mentorship</p>
                </div>
            </a>
            
            <div class="mobile-toggle" id="mobileToggle">
                <i class="fas fa-bars"></i>
            </div>
            
            <ul class="nav-menu" id="navMenu">
                <li><a href="index.html"><i class="fas fa-home"></i> Home</a></li>
                <li><a href="mentorship.html"><i class="fas fa-graduation-cap"></i> Mentorship</a></li>
                <li><a href="quiz.html"><i class="fas fa-question-circle"></i> Quizzes</a></li>
                <li><a href="about.html"><i class="fas fa-users"></i> About Us</a></li>
                <li><a href="contact.html"><i class="fas fa-phone-alt"></i> Contact</a></li>
                <li id="userAuth">
                    <!-- Will be populated by JavaScript -->
                </li>
            </ul>
        </div>
    </nav>

    <!-- Admin Container -->
    <section class="admin-container">
        <div class="container">
            <div class="admin-header">
                <h1><i class="fas fa-cog"></i> Admin Panel</h1>
                <p>Manage quizzes, study material, and user data</p>
                
                <div class="admin-tabs">
                    <button class="admin-tab active" data-tab="dashboard">Dashboard</button>
                    <button class="admin-tab" data-tab="upload-quiz">Upload Quiz</button>
                    <button class="admin-tab" data-tab="upload-material">Upload Study Material</button>
                    <button class="admin-tab" data-tab="manage-content">Manage Content</button>
                    <button class="admin-tab" data-tab="users">Users</button>
                </div>
            </div>
            
            <!-- Dashboard Tab -->
            <div class="admin-content active" id="dashboard">
                <div class="stats-grid">
                    <div class="stat-box">
                        <h3 id="totalQuizzes">0</h3>
                        <p>Total Quizzes</p>
                    </div>
                    <div class="stat-box">
                        <h3 id="totalUsers">0</h3>
                        <p>Total Users</p>
                    </div>
                    <div class="stat-box">
                        <h3 id="totalAttempts">0</h3>
                        <p>Quiz Attempts</p>
                    </div>
                    <div class="stat-box">
                        <h3 id="totalMaterials">0</h3>
                        <p>Study Materials</p>
                    </div>
                </div>
                
                <div class="recent-uploads">
                    <h3><i class="fas fa-history"></i> Recent Uploads</h3>
                    <table class="uploads-table" id="recentUploadsTable">
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Title</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="recentUploadsBody">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Upload Quiz Tab -->
            <div class="admin-content" id="upload-quiz">
                <div class="upload-box">
                    <h3><i class="fas fa-question-circle"></i> Create New Quiz</h3>
                    
                    <form id="quizForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="quizTitle">Quiz Title</label>
                                <input type="text" id="quizTitle" placeholder="Enter quiz title" required>
                            </div>
                            <div class="form-group">
                                <label for="quizCategory">Category</label>
                                <select id="quizCategory" required>
                                    <option value="">Select category</option>
                                    <option value="calculation">Calculation</option>
                                    <option value="gs">General Studies</option>
                                    <option value="english">English</option>
                                    <option value="reasoning">Reasoning</option>
                                    <option value="mock">Mock Test</option>
                                    <option value="daily">Daily Quiz</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="quizTime">Time Limit (minutes)</label>
                                <input type="number" id="quizTime" placeholder="30" required>
                            </div>
                            <div class="form-group">
                                <label for="quizQuestions">Number of Questions</label>
                                <input type="number" id="quizQuestions" placeholder="20" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="quizDescription">Description</label>
                            <textarea id="quizDescription" placeholder="Enter quiz description"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>Quiz Questions</label>
                            <div id="questionsContainer">
                                <!-- Questions will be added here -->
                            </div>
                            <button type="button" class="btn btn-outline" onclick="addQuestion()" style="margin-top: 15px;">
                                <i class="fas fa-plus"></i> Add Question
                            </button>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save Quiz
                        </button>
                    </form>
                </div>
            </div>
            
            <!-- Upload Study Material Tab -->
            <div class="admin-content" id="upload-material">
                <div class="upload-box">
                    <h3><i class="fas fa-file-pdf"></i> Upload Study Material</h3>
                    
                    <form id="materialForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="materialTitle">Material Title</label>
                                <input type="text" id="materialTitle" placeholder="Enter material title" required>
                            </div>
                            <div class="form-group">
                                <label for="materialType">Type</label>
                                <select id="materialType" required>
                                    <option value="">Select type</option>
                                    <option value="pdf">PDF</option>
                                    <option value="video">Video</option>
                                    <option value="notes">Notes</option>
                                    <option value="formula">Formula Sheet</option>
                                    <option value="pyq">Previous Year Questions</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="materialExam">Target Exam</label>
                                <select id="materialExam" required>
                                    <option value="">Select exam</option>
                                    <option value="ssc-cgl">SSC CGL</option>
                                    <option value="ssc-chsl">SSC CHSL</option>
                                    <option value="ssc-mts">SSC MTS</option>
                                    <option value="ntpc">Railway NTPC</option>
                                    <option value="banking">Banking</option>
                                    <option value="all">All Exams</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="materialSubject">Subject/Topic</label>
                                <input type="text" id="materialSubject" placeholder="e.g., Mathematics, History, etc.">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="materialDescription">Description</label>
                            <textarea id="materialDescription" placeholder="Enter material description"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>Upload File</label>
                            <div class="file-upload" id="fileUploadArea">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>Click to upload or drag and drop</p>
                                <p style="font-size: 0.9rem; color: var(--gray); margin-top: 10px;">
                                    PDF, DOC, PPT, MP4, or ZIP files (Max 100MB)
                                </p>
                                <input type="file" id="fileInput" accept=".pdf,.doc,.docx,.ppt,.pptx,.mp4,.zip">
                            </div>
                            <div id="fileName" style="margin-top: 10px; color: var(--gray);"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="driveLink">Google Drive Link (Optional)</label>
                            <input type="url" id="driveLink" placeholder="https://drive.google.com/...">
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-upload"></i> Upload Material
                        </button>
                    </form>
                </div>
            </div>
            
            <!-- Manage Content Tab -->
            <div class="admin-content" id="manage-content">
                <div class="upload-box">
                    <h3><i class="fas fa-edit"></i> Manage Quizzes</h3>
                    <div id="quizzesList">
                        <!-- Quizzes will be loaded here -->
                    </div>
                </div>
                
                <div class="upload-box">
                    <h3><i class="fas fa-folder-open"></i> Manage Study Materials</h3>
                    <div id="materialsList">
                        <!-- Materials will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- Users Tab -->
            <div class="admin-content" id="users">
                <div class="upload-box">
                    <h3><i class="fas fa-users"></i> User Management</h3>
                    <div class="form-group">
                        <input type="text" id="searchUsers" placeholder="Search users by name or email" 
                               style="width: 100%; padding: 15px; border-radius: var(--radius-md); border: 2px solid var(--gray-light);">
                    </div>
                    
                    <table class="uploads-table" id="usersTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Joined</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersBody">
                            <!-- Users will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer id="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2024 THE REPEATERS OFFICIAL. All Rights Reserved.</p>
                <div class="footer-bottom-links">
                    <a href="privacy.html">Privacy Policy</a>
                    <a href="terms.html">Terms & Conditions</a>
                    <a href="refund.html">Refund Policy</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/admin.js"></script>
    <script>
        // Tab switching
        document.querySelectorAll('.admin-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove active class from all tabs and contents
                document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.admin-content').forEach(c => c.classList.remove('active'));
                
                // Add active class to clicked tab
                tab.classList.add('active');
                
                // Show corresponding content
                const tabId = tab.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
                
                // Load data for the tab
                switch(tabId) {
                    case 'dashboard':
                        loadDashboardData();
                        break;
                    case 'manage-content':
                        loadQuizzes();
                        loadMaterials();
                        break;
                    case 'users':
                        loadUsers();
                        break;
                }
            });
        });
        
        // File upload
        const fileInput = document.getElementById('fileInput');
        const fileUploadArea = document.getElementById('fileUploadArea');
        const fileName = document.getElementById('fileName');
        
        fileUploadArea.addEventListener('click', () => {
            fileInput.click();
        });
        
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                fileName.textContent = `Selected file: ${e.target.files[0].name}`;
                fileName.style.color = 'var(--primary)';
            }
        });
        
        // Add question
        let questionCount = 0;
        
        function addQuestion() {
            questionCount++;
            const container = document.getElementById('questionsContainer');
            const questionDiv = document.createElement('div');
            questionDiv.className = 'question-item';
            questionDiv.id = `question-${questionCount}`;
            questionDiv.innerHTML = `
                <div class="question-header">
                    <h4>Question ${questionCount}</h4>
                    <div class="question-actions">
                        <button type="button" class="action-btn edit" onclick="editQuestion(${questionCount})">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button type="button" class="action-btn delete" onclick="removeQuestion(${questionCount})">
                            <i class="fas fa-trash"></i> Remove
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label>Question Text</label>
                    <textarea id="question-text-${questionCount}" placeholder="Enter question text" required></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Option A</label>
                        <input type="text" id="option-a-${questionCount}" placeholder="Option A" required>
                    </div>
                    <div class="form-group">
                        <label>Option B</label>
                        <input type="text" id="option-b-${questionCount}" placeholder="Option B" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Option C</label>
                        <input type="text" id="option-c-${questionCount}" placeholder="Option C" required>
                    </div>
                    <div class="form-group">
                        <label>Option D</label>
                        <input type="text" id="option-d-${questionCount}" placeholder="Option D" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Correct Answer</label>
                    <select id="correct-answer-${questionCount}" required>
                        <option value="">Select correct option</option>
                        <option value="A">Option A</option>
                        <option value="B">Option B</option>
                        <option value="C">Option C</option>
                        <option value="D">Option D</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Explanation (Optional)</label>
                    <textarea id="explanation-${questionCount}" placeholder="Explanation for the answer"></textarea>
                </div>
            `;
            container.appendChild(questionDiv);
        }
        
        function removeQuestion(id) {
            const questionDiv = document.getElementById(`question-${id}`);
            if (questionDiv) {
                questionDiv.remove();
            }
        }
        
        function editQuestion(id) {
            alert(`Edit question ${id} functionality will be implemented.`);
        }
        
        // Quiz form submission
        document.getElementById('quizForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const user = firebase.auth().currentUser;
            if (!user) {
                alert('Please login to upload quiz');
                return;
            }
            
            // Collect quiz data
            const quizData = {
                title: document.getElementById('quizTitle').value,
                category: document.getElementById('quizCategory').value,
                timeLimit: parseInt(document.getElementById('quizTime').value),
                questionCount: parseInt(document.getElementById('quizQuestions').value),
                description: document.getElementById('quizDescription').value,
                createdBy: user.uid,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                status: 'draft',
                attempts: 0
            };
            
            // Collect questions
            const questions = [];
            for (let i = 1; i <= questionCount; i++) {
                const questionDiv = document.getElementById(`question-${i}`);
                if (questionDiv) {
                    const question = {
                        text: document.getElementById(`question-text-${i}`).value,
                        options: {
                            A: document.getElementById(`option-a-${i}`).value,
                            B: document.getElementById(`option-b-${i}`).value,
                            C: document.getElementById(`option-c-${i}`).value,
                            D: document.getElementById(`option-d-${i}`).value
                        },
                        correctAnswer: document.getElementById(`correct-answer-${i}`).value,
                        explanation: document.getElementById(`explanation-${i}`).value
                    };
                    questions.push(question);
                }
            }
            
            quizData.questions = questions;
            
            try {
                // Save to Firestore
                const docRef = await db.collection('quizzes').add(quizData);
                alert('Quiz saved successfully! ID: ' + docRef.id);
                document.getElementById('quizForm').reset();
                document.getElementById('questionsContainer').innerHTML = '';
                questionCount = 0;
            } catch (error) {
                console.error('Error saving quiz:', error);
                alert('Error saving quiz: ' + error.message);
            }
        });
        
        // Material form submission
        document.getElementById('materialForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const user = firebase.auth().currentUser;
            if (!user) {
                alert('Please login to upload material');
                return;
            }
            
            const file = fileInput.files[0];
            if (!file) {
                alert('Please select a file to upload');
                return;
            }
            
            const materialData = {
                title: document.getElementById('materialTitle').value,
                type: document.getElementById('materialType').value,
                exam: document.getElementById('materialExam').value,
                subject: document.getElementById('materialSubject').value,
                description: document.getElementById('materialDescription').value,
                driveLink: document.getElementById('driveLink').value,
                uploadedBy: user.uid,
                uploadedAt: firebase.firestore.FieldValue.serverTimestamp(),
                status: 'published'
            };
            
            try {
                // Upload file to Firebase Storage
                const storageRef = storage.ref();
                const fileRef = storageRef.child(`materials/${Date.now()}_${file.name}`);
                const uploadTask = await fileRef.put(file);
                const downloadURL = await uploadTask.ref.getDownloadURL();
                
                materialData.fileUrl = downloadURL;
                materialData.fileName = file.name;
                materialData.fileSize = file.size;
                
                // Save to Firestore
                await db.collection('study_materials').add(materialData);
                alert('Material uploaded successfully!');
                document.getElementById('materialForm').reset();
                fileName.textContent = '';
            } catch (error) {
                console.error('Error uploading material:', error);
                alert('Error uploading material: ' + error.message);
            }
        });
        
        // Load dashboard data
        async function loadDashboardData() {
            try {
                // Get counts
                const quizzesSnapshot = await db.collection('quizzes').get();
                const usersSnapshot = await db.collection('users').get();
                const attemptsSnapshot = await db.collection('quiz_results').get();
                const materialsSnapshot = await db.collection('study_materials').get();
                
                document.getElementById('totalQuizzes').textContent = quizzesSnapshot.size;
                document.getElementById('totalUsers').textContent = usersSnapshot.size;
                document.getElementById('totalAttempts').textContent = attemptsSnapshot.size;
                document.getElementById('totalMaterials').textContent = materialsSnapshot.size;
                
                // Load recent uploads
                loadRecentUploads();
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }
        
        async function loadRecentUploads() {
            try {
                const recentQuizzes = await db.collection('quizzes')
                    .orderBy('createdAt', 'desc')
                    .limit(5)
                    .get();
                
                const recentMaterials = await db.collection('study_materials')
                    .orderBy('uploadedAt', 'desc')
                    .limit(5)
                    .get();
                
                const tbody = document.getElementById('recentUploadsBody');
                tbody.innerHTML = '';
                
                // Add quizzes
                recentQuizzes.forEach(doc => {
                    const data = doc.data();
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>Quiz</td>
                        <td>${data.title}</td>
                        <td>${new Date(data.createdAt?.toDate()).toLocaleDateString()}</td>
                        <td><span class="status-badge status-${data.status}">${data.status}</span></td>
                        <td>
                            <button class="action-btn edit" onclick="editQuiz('${doc.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
                // Add materials
                recentMaterials.forEach(doc => {
                    const data = doc.data();
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>Material</td>
                        <td>${data.title}</td>
                        <td>${new Date(data.uploadedAt?.toDate()).toLocaleDateString()}</td>
                        <td><span class="status-badge status-${data.status}">${data.status}</span></td>
                        <td>
                            <button class="action-btn edit" onclick="editMaterial('${doc.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading recent uploads:', error);
            }
        }
        
        // Initialize on load
        firebase.auth().onAuthStateChanged((user) => {
            if (user) {
                // Check if user is admin
                db.collection('users').doc(user.uid).get()
                    .then((doc) => {
                        if (doc.exists && doc.data().role === 'admin') {
                            loadDashboardData();
                        } else {
                            // Redirect non-admin users
                            alert('Access denied. Admin privileges required.');
                            window.location.href = 'index.html';
                        }
                    })
                    .catch((error) => {
                        console.error('Error checking admin status:', error);
                        window.location.href = 'index.html';
                    });
            } else {
                // Redirect to login if not authenticated
                window.location.href = 'login.html';
            }
        });
    </script>
</body>
</html>
