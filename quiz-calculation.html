<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculation Quiz - The Repeaters Official</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/quiz.css">
    <style>
        .quiz-timer {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(37, 99, 235, 0.3);
        }
        
        .calculation-formulas {
            background: #f8fafc;
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
            border-left: 5px solid #10b981;
        }
        
        .formulas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .formula-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        
        .formula-card h4 {
            color: #2563eb;
            margin-bottom: 10px;
            font-size: 1rem;
        }
        
        .formula-card p {
            font-family: 'Courier New', monospace;
            background: #f1f5f9;
            padding: 10px;
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        .question-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .question-table th {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: white;
            padding: 15px;
            text-align: left;
        }
        
        .question-table td {
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .question-table tr:hover {
            background: #f8fafc;
        }
        
        .calculation-input {
            width: 150px;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            text-align: center;
        }
        
        .calculation-input:focus {
            border-color: #2563eb;
            outline: none;
        }
        
        .submit-quiz-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            margin: 40px auto;
        }
        
        .submit-quiz-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
        }
        
        .result-panel {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 40px;
            margin-top: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .result-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .result-stat {
            text-align: center;
            padding: 25px;
            border-radius: 10px;
            background: #f8fafc;
        }
        
        .result-stat.correct {
            border-top: 5px solid #10b981;
        }
        
        .result-stat.wrong {
            border-top: 5px solid #ef4444;
        }
        
        .result-stat.score {
            border-top: 5px solid #f59e0b;
        }
        
        .result-stat.percentile {
            border-top: 5px solid #8b5cf6;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar" id="navbar">
        <div class="container nav-container">
            <a href="index.html" class="logo">
                <div class="logo-icon">
                    <i class="fas fa-redo-alt"></i>
                </div>
                <div class="logo-text">
                    <h1>THE REPEATERS OFFICIAL</h1>
                    <p>Government Exam Mentorship</p>
                </div>
            </a>
            
            <div class="mobile-toggle" id="mobileToggle">
                <i class="fas fa-bars"></i>
            </div>
            
            <ul class="nav-menu" id="navMenu">
                <li><a href="index.html"><i class="fas fa-home"></i> Home</a></li>
                <li><a href="mentorship.html"><i class="fas fa-graduation-cap"></i> Mentorship</a></li>
                <li><a href="quiz.html" class="active"><i class="fas fa-question-circle"></i> Quizzes</a></li>
                <li><a href="about.html"><i class="fas fa-users"></i> About Us</a></li>
                <li><a href="contact.html"><i class="fas fa-phone-alt"></i> Contact</a></li>
                <li id="userAuth">
                    <!-- Will be populated by JavaScript -->
                </li>
            </ul>
        </div>
    </nav>

    <!-- Quiz Header -->
    <section class="quiz-header">
        <div class="container">
            <h1><i class="fas fa-calculator"></i> CALCULATION QUIZ</h1>
            <p>Test your calculation speed and accuracy with timed questions</p>
            
            <div class="quiz-timer" id="quizTimer">
                <i class="fas fa-clock"></i>
                <span id="timer">20:00</span>
            </div>
        </div>
    </section>

    <!-- Quiz Content -->
    <section class="quiz-content">
        <div class="container">
            <!-- Formulas Sheet -->
            <div class="calculation-formulas">
                <h3><i class="fas fa-lightbulb"></i> Important Formulas (Quick Reference)</h3>
                <div class="formulas-grid">
                    <div class="formula-card">
                        <h4>Percentage</h4>
                        <p>X% of Y = (X × Y) ÷ 100</p>
                    </div>
                    <div class="formula-card">
                        <h4>Profit & Loss</h4>
                        <p>Profit % = (Profit ÷ CP) × 100</p>
                    </div>
                    <div class="formula-card">
                        <h4>Simple Interest</h4>
                        <p>SI = (P × R × T) ÷ 100</p>
                    </div>
                    <div class="formula-card">
                        <h4>Compound Interest</h4>
                        <p>CI = P[(1 + R/100)ⁿ - 1]</p>
                    </div>
                    <div class="formula-card">
                        <h4>Average</h4>
                        <p>Avg = Sum of terms ÷ No. of terms</p>
                    </div>
                    <div class="formula-card">
                        <h4>Ratio Proportion</h4>
                        <p>a:b = c:d ⇒ a × d = b × c</p>
                    </div>
                </div>
            </div>
            
            <!-- Questions Table -->
            <div class="quiz-questions" id="quizQuestions">
                <h3>Calculation Questions (20 Questions - 20 Minutes)</h3>
                
                <table class="question-table">
                    <thead>
                        <tr>
                            <th width="5%">#</th>
                            <th width="65%">Question</th>
                            <th width="30%">Your Answer</th>
                        </tr>
                    </thead>
                    <tbody id="questionsTable">
                        <!-- Questions will be populated by JavaScript -->
                    </tbody>
                </table>
                
                <button class="submit-quiz-btn" id="submitQuiz">Submit Quiz</button>
            </div>
            
            <!-- Results Panel -->
            <div class="result-panel" id="resultPanel">
                <h2><i class="fas fa-chart-bar"></i> Quiz Results</h2>
                
                <div class="result-stats">
                    <div class="result-stat correct">
                        <h3 id="correctAnswers">0</h3>
                        <p>Correct Answers</p>
                    </div>
                    
                    <div class="result-stat wrong">
                        <h3 id="wrongAnswers">0</h3>
                        <p>Wrong Answers</p>
                    </div>
                    
                    <div class="result-stat score">
                        <h3 id="totalScore">0</h3>
                        <p>Total Score</p>
                    </div>
                    
                    <div class="result-stat percentile">
                        <h3 id="percentile">0</h3>
                        <p>Percentile</p>
                    </div>
                </div>
                
                <div class="result-details">
                    <h3>Detailed Analysis</h3>
                    <div id="analysisDetails">
                        <!-- Analysis will be populated by JavaScript -->
                    </div>
                </div>
                
                <div class="result-actions">
                    <button class="btn btn-primary" id="retryQuiz">
                        <i class="fas fa-redo"></i> Retry Quiz
                    </button>
                    <button class="btn btn-secondary" id="viewSolutions">
                        <i class="fas fa-lightbulb"></i> View Solutions
                    </button>
                    <a href="quiz.html" class="btn btn-outline">
                        <i class="fas fa-list"></i> More Quizzes
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer id="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2024 THE REPEATERS OFFICIAL. All Rights Reserved.</p>
                <div class="footer-bottom-links">
                    <a href="privacy.html">Privacy Policy</a>
                    <a href="terms.html">Terms & Conditions</a>
                    <a href="refund.html">Refund Policy</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/quiz.js"></script>
    <script>
        // Quiz Questions Data
        const calculationQuestions = [
            {
                id: 1,
                question: "What is 25% of 480?",
                answer: 120,
                type: "percentage",
                formula: "X% of Y = (X × Y) ÷ 100"
            },
            {
                id: 2,
                question: "If CP = ₹500 and SP = ₹600, what is the profit percentage?",
                answer: 20,
                type: "profit-loss",
                formula: "Profit % = [(SP-CP)/CP] × 100"
            },
            {
                id: 3,
                question: "Simple Interest on ₹10,000 at 5% for 3 years?",
                answer: 1500,
                type: "simple-interest",
                formula: "SI = (P × R × T) ÷ 100"
            },
            {
                id: 4,
                question: "Compound Interest on ₹8,000 at 10% for 2 years?",
                answer: 1680,
                type: "compound-interest",
                formula: "CI = P[(1 + R/100)ⁿ - 1]"
            },
            {
                id: 5,
                question: "Average of 15, 25, 35, 45, 55?",
                answer: 35,
                type: "average",
                formula: "Avg = Sum ÷ Count"
            },
            {
                id: 6,
                question: "If 2:3 = 8:x, find x?",
                answer: 12,
                type: "ratio",
                formula: "a:b = c:d ⇒ a × d = b × c"
            },
            {
                id: 7,
                question: "45 × 12 = ?",
                answer: 540,
                type: "multiplication",
                formula: "Direct multiplication"
            },
            {
                id: 8,
                question: "784 ÷ 14 = ?",
                answer: 56,
                type: "division",
                formula: "Direct division"
            },
            {
                id: 9,
                question: "456 + 789 = ?",
                answer: 1245,
                type: "addition",
                formula: "Direct addition"
            },
            {
                id: 10,
                question: "1000 - 567 = ?",
                answer: 433,
                type: "subtraction",
                formula: "Direct subtraction"
            }
        ];
        
        let timer;
        let timeLeft = 20 * 60; // 20 minutes in seconds
        let userAnswers = {};
        
        // Initialize Quiz
        function initializeQuiz() {
            // Check authentication
            const user = firebase.auth().currentUser;
            if (!user) {
                window.location.href = 'login.html';
                return;
            }
            
            // Populate questions table
            const tableBody = document.getElementById('questionsTable');
            calculationQuestions.forEach((q, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${q.id}</td>
                    <td>
                        <strong>${q.question}</strong><br>
                        <small style="color: #64748b;">Type: ${q.type} | Formula: ${q.formula}</small>
                    </td>
                    <td>
                        <input type="number" 
                               class="calculation-input" 
                               id="answer_${q.id}"
                               placeholder="Enter answer"
                               oninput="saveAnswer(${q.id}, this.value)">
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Start timer
            startTimer();
        }
        
        // Timer function
        function startTimer() {
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    submitQuiz();
                }
            }, 1000);
        }
        
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Change color when time is running out
            if (timeLeft < 300) { // 5 minutes
                document.getElementById('quizTimer').style.background = 
                    'linear-gradient(135deg, #ef4444, #dc2626)';
            }
        }
        
        // Save user answers
        function saveAnswer(questionId, answer) {
            userAnswers[questionId] = parseFloat(answer) || null;
        }
        
        // Submit Quiz
        document.getElementById('submitQuiz').addEventListener('click', submitQuiz);
        
        function submitQuiz() {
            clearInterval(timer);
            
            // Calculate results
            let correct = 0;
            let wrong = 0;
            let score = 0;
            
            calculationQuestions.forEach(q => {
                const userAnswer = userAnswers[q.id];
                const correctAnswer = q.answer;
                
                if (userAnswer === correctAnswer) {
                    correct++;
                    score += 4; // +4 for correct
                } else if (userAnswer !== null) {
                    wrong++;
                    score -= 1; // -1 for wrong (negative marking)
                }
            });
            
            // Calculate percentile (simplified)
            const percentile = Math.min(99, Math.round((correct / calculationQuestions.length) * 100));
            
            // Show results
            document.getElementById('quizQuestions').style.display = 'none';
            document.getElementById('resultPanel').style.display = 'block';
            
            document.getElementById('correctAnswers').textContent = correct;
            document.getElementById('wrongAnswers').textContent = wrong;
            document.getElementById('totalScore').textContent = score;
            document.getElementById('percentile').textContent = percentile + '%';
            
            // Detailed analysis
            const analysisDiv = document.getElementById('analysisDetails');
            analysisDiv.innerHTML = `
                <div style="background: #f1f5f9; padding: 20px; border-radius: 10px;">
                    <h4>Performance Summary:</h4>
                    <p>You answered ${correct} out of ${calculationQuestions.length} questions correctly.</p>
                    <p>Accuracy: ${((correct / calculationQuestions.length) * 100).toFixed(1)}%</p>
                    <p>Time Taken: ${(20 - (timeLeft / 60)).toFixed(1)} minutes</p>
                    
                    <h4 style="margin-top: 20px;">Question-wise Analysis:</h4>
                    <table style="width: 100%; margin-top: 10px;">
                        <thead>
                            <tr>
                                <th>Question</th>
                                <th>Your Answer</th>
                                <th>Correct Answer</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${calculationQuestions.map(q => `
                                <tr>
                                    <td>${q.question}</td>
                                    <td>${userAnswers[q.id] || 'Not attempted'}</td>
                                    <td>${q.answer}</td>
                                    <td>
                                        ${userAnswers[q.id] === q.answer 
                                            ? '<span style="color: #10b981;">✓ Correct</span>' 
                                            : userAnswers[q.id] === null 
                                                ? '<span style="color: #64748b;">Not attempted</span>'
                                                : '<span style="color: #ef4444;">✗ Wrong</span>'}
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            // Save results to Firebase
            saveQuizResults(correct, wrong, score, percentile);
        }
        
        function saveQuizResults(correct, wrong, score, percentile) {
            const user = firebase.auth().currentUser;
            if (!user) return;
            
            const quizData = {
                userId: user.uid,
                userName: user.displayName || user.email,
                quizType: 'calculation',
                correctAnswers: correct,
                wrongAnswers: wrong,
                totalQuestions: calculationQuestions.length,
                score: score,
                percentile: percentile,
                timeSpent: (20 * 60) - timeLeft,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            db.collection('quiz_results').add(quizData)
                .then(() => {
                    console.log('Quiz results saved');
                })
                .catch((error) => {
                    console.error('Error saving results:', error);
                });
        }
        
        // Retry Quiz
        document.getElementById('retryQuiz').addEventListener('click', () => {
            location.reload();
        });
        
        // View Solutions
        document.getElementById('viewSolutions').addEventListener('click', () => {
            alert('Detailed solutions will be shown here. In the complete version, this will open a modal with step-by-step solutions.');
        });
        
        // Initialize on load
        window.addEventListener('load', initializeQuiz);
    </script>
</body>
</html>
